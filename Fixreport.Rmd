---
title: "Logistic Regression Model for Class of Breast Cancer"
author: "Hoang H. Ha and Thu A. Nguyen"
Contact: Hoang: +84918362924
         Thu :  +84942000639
date: "4/28/2020"
output:
html_document:
  code_download: yes
  df_print: kable
  highlight: tango
---

# Introduction
Breast cancer is cancer that develops from breast tissue. Signs of breast cancer may include a lump in the breast, a change in breast shape, dimpling of the skin, fluid coming from the nipple, a newly-inverted nipple, or a red or scaly patch of skin. In this report, we will research factors which can affect the recurrence of breast cancer such as: age, menopause, tumor.size, inv.nodes, node.caps, deg.malig, breast, breast.quad.

This dataset is one of three domains provided by the Oncology Institute that has repeatedly appeared in the machine learning literature.

It includes 201 instances of one class and 85 instances of another class. The instances are described by 9 attributes, some of which are linear and some are nominal.

# Data loading
```{r message=FALSE, warning=FALSE}
# Install the required library
library(dplyr)
library(ggplot2)
library(Hmisc)
library(gridExtra)
library(caTools)


# Load the dataset
data = read.csv("https://raw.githubusercontent.com/pnhuy/bioinfo/master/datasets/breast_cancer/breast-cancer.csv")
```

#Exploratory data analysis
The data have 286 rows of patients, and 10 fields: Class, age, menopause, tumor.size, inv.nodes, node.caps, deg.malig, breast, breast.quad, irradiat
```{r}
head(data)
```

```{r}
#Structure
str(data)
```

The basic statisics of data was below: 
```{r}
summary(data)
```
We run the summary function to show each column, itâ€™s data type and few other attributes which are useful for attributes (displays min, 1st quartile, median, mean, 3rd quartile, max values or the number of patient in each level)

Besides,the data might contain NA values and they would be checked before building the model.
```{r}
sum(is.na(data))
```
This data have no NA values.

```{r}
#Illustrate the relationship between Class and age
table(data$Class,data$age)
```

```{r}
#correlation coefficient between variables
pairs.panels(data)
```

There is not NA showing, there are some ? which appears in the summary view. Therefore, we will remove ? values in breast.quad and node.caps columns.
```{r}
data = filter(data, breast.quad != '?' & node.caps != '?')
```

Bar plots for one variable
```{r fig.height=12, fig.width=18}
p1 = ggplot(data, aes(age)) + geom_bar(aes(fill=age))+labs(title = "Age")
p2 = ggplot(data, aes(Class)) +geom_bar(aes(fill=Class))+labs(title = "Class")
p3 = ggplot(data, aes(irradiat)) + geom_bar(aes(fill=irradiat))+labs(title = "irradiat")
p4 = ggplot(data, aes(breast.quad)) + geom_bar(aes(fill=breast.quad))+labs(title = "breast.quad")
p5 = ggplot(data, aes(breast)) + geom_bar(aes(fill=breast))+labs(title = "breast")
p6 = ggplot(data, aes(node.caps)) + geom_bar(aes(fill=node.caps))+ labs(title = "node.caps")
p7 = ggplot(data, aes(menopause)) + geom_bar(aes(fill=menopause))+labs(title = "menopause")
p8 = ggplot(data, aes(tumor.size)) + geom_bar(aes(fill=tumor.size))+labs(title = "Tumor Size")
p9 = ggplot(data, aes(inv.nodes)) + geom_bar(aes(fill=inv.nodes))+labs(title = "inv nodes")
grid.arrange(p1,p2,p3,p4,p5,p6,p7,p8,p9)
```

Plot of multiple variables
```{r}
ggplot(data=data,aes(x=age,fill=irradiat,))+geom_bar()
ggplot(data,aes(tumor.size))+geom_bar()+facet_wrap(~irradiat)+theme(axis.text.x = element_text(angle = 90))+ggtitle("Irradiation Based on Tumor Size")+xlab("Tumor Size")+ylab("Count")
ggplot(data,aes(x=Class,fill=irradiat))+geom_bar(position ="dodge")
ggplot(data,aes(x=tumor.size,fill=menopause))+geom_bar(position="dodge")
ggplot(data,aes(x=age,fill=tumor.size))+geom_bar(position ="dodge")
```

```{r}
##Pie chart for Menopause using coord_polar
ggplot(data,aes(x="",fill=menopause)) + geom_bar(width=3)+coord_polar("y")
```

Density plot
```{r}
ggplot(data,aes(x=`deg.malig`,fill=`tumor.size`))+geom_density(alpha=0.4)+ggtitle("Deg Malignant vs Tumor size")+xlab("Deg Malignant")+ylab("Density")
```


```{r}
#Fix NA in nodecaps
data$node.caps=ifelse(is.na(data$node.caps),ave(data$node.caps,FUN=function(x)"no"),data$node.caps)
#Fix NA in breasquad
data$breast.quad=ifelse(is.na(data$breast.quad),ave(data$breast.quad,FUN=function(x)"left_low"),data$breast.quad)
#Check levels
factor (data$irradiat)
#Labeling features
data$Class= factor (data$Class, labels= c(0,1) , levels= c("no-recurrence-events", "recurrence-events"))
data$age= factor (data$age,labels= c(0,1,2,3,4,5) , levels= c("20-29","30-39","40-49","50-59","60-69","70-79")) 
data$menopause= factor (data$menopause, labels= c(0,1,2) , levels= c("premeno","ge40","lt40")) 
data$tumor.size= factor (data$tumor.size, labels= c(0,1,2,3,4,5,6,7,8,9,10) , levels= c("0-4","5-9","10-14", "15-19", "20-24","25-29", "30-34", "35-39","40-44","45-49","50-54")) 
data$inv.nodes= factor (data$inv.nodes, labels= c(0,1,2,3,4,5,6) , levels= c("0-2","3-5","6-8", "9-11","12-14", "15-17", "24-26"))
data$node.caps= factor (data$node.caps, labels= c(0,1) , levels= c("2", "3"))
data$deg.malig= factor (data$deg.malig, labels= c(0,1,2) , levels= c("1", "2", "3"))
data$breast= factor (data$breast, labels= c(0,1) , levels= c("left", "right")) 
data$breast.quad= factor (data$breast.quad, labels= c(0,1,2,3,4) , levels= c("2", "3", "4", "5", "6")) 
data$irradiat= factor (data$irradiat, labels= c(0,1) , levels= c("no", "yes")) 
```


# Hypothesis testing
## Ttest
```{r}
#Testing tumorsize vs irradiat
t.test(as.numeric(data$tumor.size)~data$irradiat)
```

```{r}
#Test tumorsize vs nodecaps
t.test(as.numeric(data$tumor.size)~data$node.caps)
```

## ANOVA
```{r}
ANOVA = aov(as.numeric(data$tumor.size)~data$node.caps, data=data)
summary(ANOVA)
TukeyHSD(ANOVA)
```

# Logistic regression Model
```{r}
full.model = bayesglm(Class ~ ., data=data,family="binomial")
step.model <- stepAIC(full.model, direction = "forward", trace = FALSE)
summary(step.model)
```

```{r}
set.seed(1234)
split <-sample.split(data$Class,SplitRatio =0.8 )

#training set
training_set <-subset(data,split==T)

#test set
test_set <-subset(data,split==F)

View(training_set)
View(test_set)

#generalised linear model
classifier <-glm(formula=Class~. ,family = binomial(),data=training_set)
summary(classifier)

#probability predict
prob_pred <-predict(classifier,type="response",newdata=test_set[-3])
prob_pred

y_pred <- ifelse(prob_pred>0.4,1,0)
y_pred
```

# Interpret the model
## Variables names
+ node.caps1,breast.quad1,breast.quad2,breast.quad4 are $X_{1}$,$X_{2}$,$X_{3}$,$X_{4}$, respectively.
+ tumor.size is Y.
The model above is achieved by using the lm() function in R and the output is called using the summary() function on the model.
Formula Call:
  $Y=4,14+0,69X_{1} +1,36X_{2} +1,56X_{3} +2,20X_{4}$
  
Residuals : break down into 5 sumary point:  Min, Max, Median, 1Q,3Q. In the model, we can see that the distribution of the residuals do not appear to be strongly symetrical. 

Cofficients : reprensent the intercept, slope terms, P-value
Another results : R-square = 0.1368, Adjusted R squared = 0.1144, F statistic = 6.092

## Conclusion
